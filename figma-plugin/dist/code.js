!function(){"use strict";function e(e){let a=0,t=0,i=0,s=1;const r=e.match(/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*([0-9.]+))?\s*\)/i);if(r)return a=parseInt(r[1],10)/255,t=parseInt(r[2],10)/255,i=parseInt(r[3],10)/255,s=r[4]?parseFloat(r[4]):1,{r:a,g:t,b:i,a:s};const n=e.replace(/^#/,"");return 3===n.length?(a=parseInt(n[0]+n[0],16)/255,t=parseInt(n[1]+n[1],16)/255,i=parseInt(n[2]+n[2],16)/255):4===n.length?(a=parseInt(n[0]+n[0],16)/255,t=parseInt(n[1]+n[1],16)/255,i=parseInt(n[2]+n[2],16)/255,s=parseInt(n[3]+n[3],16)/255):6===n.length?(a=parseInt(n.slice(0,2),16)/255,t=parseInt(n.slice(2,4),16)/255,i=parseInt(n.slice(4,6),16)/255):8===n.length&&(a=parseInt(n.slice(0,2),16)/255,t=parseInt(n.slice(2,4),16)/255,i=parseInt(n.slice(4,6),16)/255,s=parseInt(n.slice(6,8),16)/255),a=Math.max(0,Math.min(1,a)),t=Math.max(0,Math.min(1,t)),i=Math.max(0,Math.min(1,i)),s=Math.max(0,Math.min(1,s)),{r:a,g:t,b:i,a:s}}figma.showUI(__html__,{width:800,height:700}),figma.ui.onmessage=a=>{const t=a;switch(t.type){case"create-pixel-art":!function(a){const{grid:t,pixelSize:i=40,width:s=t[0].length,height:r=t.length,gridGap:n=0,pixelShape:c="square",cornerRadius:o=0,includeBackground:l=!1}=a,g=figma.createFrame();g.name="PixelPop Artwork";const p=s*(i+n)-n,h=r*(i+n)-n;if(g.resize(p,h),l&&a.backgroundColor){const t=e(a.backgroundColor);g.fills=[{type:"SOLID",color:{r:t.r,g:t.g,b:t.b},opacity:t.a}]}else g.fills=[];const m=500;let f=[];for(let e=0;e<r;e++)for(let a=0;a<s;a++)t[e]&&t[e][a]&&f.push({x:a,y:e,color:t[e][a]});const u=f.length,d=Math.ceil(u/m);u>m&&figma.notify(`Creating ${u} pixels in ${d} batches...`);for(let I=0;I<d;I++){const a=I*m,t=Math.min(a+m,u);f.slice(a,t).forEach((({x:a,y:t,color:s})=>{const r=figma.createRectangle();r.x=a*(i+n),r.y=t*(i+n),r.resize(i,i),"rounded"!==c&&"circle"!==c||(r.cornerRadius="circle"===c?i/2:o||4);const l=e(s);r.fills=[{type:"SOLID",color:{r:l.r,g:l.g,b:l.b},opacity:l.a}],g.appendChild(r)})),d>1&&figma.notify(`Processed batch ${I+1}/${d}`)}figma.currentPage.selection=[g],figma.viewport.scrollAndZoomIntoView([g]),figma.notify(`Pixel art created successfully with ${u} pixels!`)}(t.pixelData);break;case"resize-ui":figma.ui.resize(t.width,t.height);break;case"notify":figma.notify(t.message);break;case"cancel":figma.closePlugin()}},figma.command&&function(e){switch(e){case"create-pixel-art":case"import-to-figma":break;case"about":figma.notify("PixelPop: A pixel art creation tool"),figma.closePlugin()}}(figma.command)}();
